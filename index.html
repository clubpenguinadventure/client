<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <title>Club Penguin</title>

        <link rel="stylesheet" href="assets/styles/styles.css" type="text/css">

        <!-- Fonts -->
        <script src="assets/scripts/lib/webfont.js"></script>

        <!-- Phaser -->
        <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
        <script src="assets/scripts/lib/phaser-cachebuster.min.js"></script>

        <!-- Ruffle -->
        <script src="https://cdn.jsdelivr.net/npm/@ruffle-rs/ruffle/ruffle.min.js"></script>

        <!-- Client bundle -->
		<script>
			window.HUB_URL = 'http://localhost:3000';
		</script>
        <script src="assets/scripts/client/yukon.bundle.js"></script>
    </head>

    <body>
		<div class="header" id="header">
			<div class="header-content">
				<div class="links">
					<a href="https://cpchat.net">Website Home</a>
					<a href="https://community.cpchat.net">Community</a>
					<a href="https://cpchat.net/support">Support</a>
					<a href="https://cpchat.net/legal">Legal</a>
					<a href="https://wiki.cpchat.net">Wiki</a>
				</div>
				<div class="buttons">
					<button id="largescreen">Large Screen</button>
					<button id="fullscreen">Full Screen</button>
					<button id="toggleDarkMode">Toggle Color</button>
				</div>
				<div class="links">
					<a href="#">Log Out</a>
				</div>
			</div>
		</div>
			<script>
				document.addEventListener('DOMContentLoaded', function() {
					const toggleButton = document.getElementById('toggleDarkMode');
					const fullscreenButton = document.getElementById('fullscreen');
					const largescreenButton = document.getElementById('largescreen');
					const body = document.body;
					let mode;
					setMode(localStorage.getItem('theme') || 'blue');
					let isLargeScreen = false; // Track large screen state
			
					// Toggle between light, dark, and blue modes
					toggleButton.addEventListener('click', () => {
						switch(mode){
							case 'light':
								setMode('dark');
								break;
							case 'dark':
								setMode('blue');
								break;
							case 'blue':
								setMode('light');
								break;
						}

						body.dispatchEvent(new Event('themeChanged'));
					});

					function setMode(targetMode){
						let modes = ['light', 'dark', 'blue'];
						modes.forEach(m => {
							if(m === targetMode){
								body.classList.add(`${m}-mode`);
							}else{
								body.classList.remove(`${m}-mode`);
							}
						});
						localStorage.setItem('theme', targetMode);
						body.dispatchEvent(new Event('themeChanged'));
						mode = targetMode;
					}
			
					// Fullscreen button functionality (using original code to avoid Phaser error)
					fullscreenButton.addEventListener('click', () => {
						document.getElementById('header').style.display = 'none';
						const gameElement = document.getElementById('game');
						gameElement.style.maxWidth = '100%';
						gameElement.style.maxHeight = '100%';
						gameElement.style.height = '100%';
						document.documentElement.requestFullscreen(); // Fullscreen the entire document
					});
			
					// Exit fullscreen changes when fullscreen is exited
					document.addEventListener('fullscreenchange', () => {
						if (!document.fullscreenElement) {
							document.getElementById('header').style.display = 'flex';
							const gameElement = document.getElementById('game');
							gameElement.style.maxWidth = localStorage.getItem("scale") ? localStorage.getItem("scale") * 760 + 'px' : '1520px';
							gameElement.style.height = 'calc(100vh - 35px)'; // Adjust height based on header
						}
					});
			
					// Large Screen button functionality
					largescreenButton.addEventListener('click', () => {
						const gameElement = document.getElementById('game');
						if (!isLargeScreen) {
							gameElement.style.maxWidth = '100%';
							gameElement.style.maxHeight = '100%';
						} else {
							gameElement.style.maxWidth = localStorage.getItem("scale") ? localStorage.getItem("scale") * 760 + 'px' : '1520px';
						}
						isLargeScreen = !isLargeScreen;
					});

					
					document.getElementById('game').style.maxWidth = localStorage.getItem("scale") ? parseInt(localStorage.getItem("scale")) * 760 + 'px' : '1520px';
				});
			</script>
        <div id="game" class="game">
			<input type="text" id='dummyForMobileKeyboard'
				style='position: absolute; top: -100px; left: -100px; width: 1px; height: 1px; opacity: 0;' />
		</div>
		<script>
				var dummyBox = document.getElementById('dummyForMobileKeyboard');
				dummyBox.onkeyup = () => {
					processKey()
				}

				function processKey() {
					dummyBox = document.getElementById('dummyForMobileKeyboard');
					var e = new KeyboardEvent('keydown', {
						bubbles: true,
						cancelable: true,
						keyCode: dummyBox.value.charCodeAt(dummyBox.value.length - 1),
						key: dummyBox.value.substring(dummyBox.value.length - 1),
					});
					document.onkeydown(e);
					dummyBox.remove()
					var newDummy = document.createElement('input')
					newDummy.type = 'text'
					newDummy.id = 'dummyForMobileKeyboard'
					newDummy.style = 'position: absolute; top: -100px; left: -100px; width: 1px; height: 1px; opacity: 0;'
					document.body.appendChild(newDummy)
					newDummy.focus()
					newDummy.onkeyup = () => {
						processKey()
					}
				}
		</script>
    </body>

</html>
